# Plan d'impl√©mentation - Syst√®me de recherche multi-crit√®res
**Date : 06/01/2025**
**Mise √† jour apr√®s audit : 06/01/2025**
**Derni√®re mise √† jour : 07/01/2025** - Phase 1 compl√®te + Section Identification connect√©e

## üéØ Objectif
Connecter l'interface de recherche multi-crit√®res existante avec les donn√©es Firebase pour permettre des recherches fonctionnelles.

## ‚úÖ R√©sum√© de l'audit

### Sections pr√™tes (donn√©es existantes) ‚úÖ
- **Identification** : Tous les champs existent
- **Activit√©s** : Syst√®me de tags complet  
- **R√©seaux** : Via RESEAUX_HIERARCHY
- **Genres** : Via GENRES_HIERARCHY
- **G√©olocalisation** : Champs d'adresse complets
- **Festivals** : Via ContactDiffusionSection
- **Salles** : Via ContactSalleSection
- **Dates** : Collection s√©par√©e fonctionnelle
- **Artistes** : Collection existante dans Booking > Param√©trage

### Sections √† adapter üîÑ
- **Personnes** : Manque le champ priorit√©
- **Mes s√©lections** : Nouvelle fonctionnalit√© √† cr√©er
- **Historique** : Pas de structure pour dossiers/notes
- **Infos artiste** : Collection existe mais manque des champs sp√©cifiques
- **Projets** : Collection existe mais manque la vue d√©taill√©e (fiche projet)

## üìã Plan d'impl√©mentation r√©vis√©

### Phase 1 : Infrastructure de base (2-3 jours)

#### 1.1 Service de recherche principal ‚úÖ COMPL√âT√â (07/01/2025)
- [x] Cr√©er `services/searchService.js`
- [x] Cr√©er `config/searchFieldsMapping.js` pour le mapping UI ‚Üí Firebase
- [x] Impl√©menter les op√©rateurs de base :
  - `contient` : Recherche textuelle
  - `egal` : Correspondance exacte
  - `entre` : Plage de valeurs
  - `parmi` : Multi-s√©lection
  - `commence` / `termine` : Pr√©fixe/suffixe
  - `non_renseigne` : Champs vides
  - `different` : Non √©gal
  - `superieur` / `inferieur` : Comparaisons num√©riques
- [x] Gestion des crit√®res Firestore vs locaux
- [x] Support de la pagination
- [x] Recherche multi-collections
- [x] Sauvegarde/chargement des recherches

#### 1.2 Int√©gration dans RechercheLayout ‚úÖ COMPL√âT√â (07/01/2025)
- [x] Connecter le service de recherche
- [x] Impl√©menter les fonctions pour les 3 boutons :
  - `handleCalculate()` : Compte les r√©sultats
  - `handleDisplay()` : Affiche les r√©sultats dans la zone centrale
  - `handleSave()` : Sauvegarde la recherche avec modal
- [x] G√©rer l'√©tat des r√©sultats
- [x] Cr√©er l'affichage des r√©sultats (tableau avec navigation)
- [x] Modal de sauvegarde fonctionnelle
- [x] Indicateur de chargement et compteur de r√©sultats

### Phase 2 : Sections sans modification de donn√©es (3-4 jours)

#### 2.1 Identification ‚úÖ CONNECT√â (07/01/2025)
- [x] Mapper les champs UI vers Firebase
- [x] G√©rer les op√©rateurs de recherche (contient, √©gal, commence, termine, diff√©rent)
- [x] G√©rer les plages de dates (entre, sup√©rieur, inf√©rieur)
- [x] G√©rer les bool√©ens (oui/non/indiff√©rent)
- [x] Labels lisibles dans l'affichage des crit√®res
- [x] Mise √† jour dynamique des crit√®res (ajout/modification/suppression)

#### 2.2 Activit√©s ‚úÖ CONNECT√â (07/01/2025)
- [x] Utilisation de TAGS_HIERARCHY depuis la config
- [x] Mapping vers le champ `tags` Firebase
- [x] Support de la hi√©rarchie compl√®te avec sous-cat√©gories
- [x] Un seul crit√®re pour toutes les activit√©s s√©lectionn√©es
- [x] Affichage avec indentation pour les sous-cat√©gories
- [x] S√©lection/d√©s√©lection par cat√©gorie

#### 2.3 R√©seaux ‚úÖ CONNECT√â (07/01/2025)
- [x] Utilisation de RESEAUX_HIERARCHY depuis la config
- [x] Mapping vers le champ `tags` Firebase
- [x] Recherche et filtrage des r√©seaux
- [x] S√©lection multiple avec un seul crit√®re
- [x] Compteur de s√©lection et affichage des labels

#### 2.4 Genres ‚úÖ CONNECT√â (07/01/2025)
- [x] Utilisation de GENRES_HIERARCHY depuis la config
- [x] Mapping vers le champ `tags` Firebase (comme activit√©s)
- [x] Support de la hi√©rarchie compl√®te avec accord√©on
- [x] S√©lection multiple avec un seul crit√®re
- [x] Affichage avec indentation pour les sous-genres

#### 2.5 G√©olocalisation ‚úÖ CONNECT√â (07/01/2025)
- [x] Mapping complet : codePostal, ville, pays, r√©gion, d√©partement
- [x] Op√©rateurs adapt√©s √† chaque type de champ
- [x] Gestion des labels pour pays/r√©gion/d√©partement
- [x] Suppression des crit√®res vides
- [ ] √Ä faire plus tard : calcul auto d√©partement/r√©gion depuis code postal

#### 2.6 Festivals ‚úÖ CONNECT√â (07/01/2025)
- [x] Mapping complet : nomFestival, commentaires, bouclage, periodeFestivalComplete
- [x] S√©lection multi-mois pour bouclage
- [x] Grille interactive pour p√©riodes de diffusion
- [x] Conversion des semaines en description lisible
- [x] Tous les op√©rateurs de recherche support√©s

#### 2.7 Salles ‚úÖ CONNECT√â (07/01/2025)
- [x] Mapping : salleJauge1/2/3, salleOuverture, salleHauteur, salleProfondeur
- [x] Recherche par plage de valeurs (min/max)
- [x] Op√©rateurs dynamiques : entre, superieur, inferieur
- [x] Unit√©s d'affichage (places, m√®tres)
- [x] Informations contextuelles sur les crit√®res

#### 2.8 Dates ‚úÖ CONNECT√â (07/01/2025)
- [x] Utilisation de la collection `dates`
- [x] Impl√©mentation des filtres : niveau, statut, titre, p√©riode
- [x] Recherche par artiste et lieu associ√©s
- [x] Recherche par montant (plage de valeurs)
- [x] Recherche dans les notes
- [x] Refonte du champ niveau : utilisation pour les √©tats (Incompl√®te, Int√©r√™t, Option, Confirm√©, Annul√©, Report√©)
- [x] Cr√©ation du composant NiveauDisplay pour l'affichage visuel adapt√© (barres ou ic√¥nes)

### Phase 3 : Ajout de fonctionnalit√©s (2-3 jours)

#### 3.3 PersonnesSection - Connexion au syst√®me de recherche
- [ ] Mapper les champs vers Firebase
- [ ] Impl√©menter tous les filtres existants
- [ ] G√©rer les crit√®res multiples

#### 3.1 Personnes - Ajout du champ priorit√©
- [ ] Ajouter `priorite` dans ContactForm
- [ ] Migration des contacts existants (priorit√© par d√©faut)
- [ ] Impl√©menter le filtre

#### 3.2 Mes s√©lections - Nouvelle fonctionnalit√© ‚úÖ COMPL√âT√â (07/01/2025)
- [x] Cr√©er collection `selections` dans Firebase (utilise la collection existante)
- [x] Structure : `{nom, type, criteres, userId, organizationId, shared, createdAt, updatedAt}`
- [x] Service selectionsService.js pour sauvegarder/charger les s√©lections
- [x] UI MesSelectionsSection pour g√©rer les s√©lections
- [x] Int√©gration compl√®te dans RechercheLayout avec onLoadSelection
- [x] Modal d'√©dition et de suppression
- [x] Support des s√©lections partag√©es avec l'√©quipe

### Phase 4 : Sections complexes (7-8 jours)

#### 4.1 Fiche Projet - Nouvelle vue d√©taill√©e
- [ ] Cr√©er `ProjetView.js` similaire √† `ContactView`
- [ ] Ajouter les nouveaux champs dans la collection projets :
  - [ ] `favori` (boolean)
  - [ ] `suivi` (string)
  - [ ] `estActif` (boolean)
  - [ ] `prixVente`, `frais`, `jaugePossible`, `disponibilites`
  - [ ] `contactsIds` (array) pour les contacts associ√©s
  - [ ] `tags` (array)
  - [ ] `commentaires` (string √©tendu)
- [ ] Cr√©er les routes `/projets/:id` pour la vue d√©taill√©e
- [ ] Cr√©er les sections : En-t√™te, Infos principales, Contacts li√©s, Tags/Commentaires
- [ ] Impl√©menter les onglets de navigation :
  - [ ] `Documentation` - Gestion des documents du projet
  - [ ] `Suivi commercial` - Historique et suivi des √©changes
  - [ ] `Gestion de projets` - Planning et t√¢ches
  - [ ] `Devis` - Liste et cr√©ation de devis
  - [ ] `Dates` - Tableau des dates (r√©utiliser composant existant)
  - [ ] `√âquipe` - Membres de l'√©quipe projet
- [ ] Service pour g√©rer les relations bidirectionnelles projet-contact
- [ ] Composant `ProjetTabs` pour la navigation entre sections

#### 4.2 Historique - Structure √† cr√©er
- [ ] Option 1 : Sous-collection `historique` par contact
- [ ] Option 2 : Collection globale `historique` avec contactId
- [ ] D√©cider et impl√©menter

#### 4.3 Infos artiste - Extension de la fiche artiste existante ‚úÖ
- [ ] **Collection `artistes` existe d√©j√†** dans Booking > Param√©trage
- [ ] √âtendre ArtisteForm avec 4 nouvelles sections :
  - [ ] ArtisteExtendedInfoSection : formations, anneeCreation, manager, structureGestion, lieuRepetition
  - [ ] ArtisteDisqueSection : label, editeurPhono, environnementDisque, supportAudio, discographie, nombreConcerts
  - [ ] ArtisteSceneSection : environnementScene, referencesScene, tourneur
  - [ ] ArtisteMediaSection : attachePresse, supportVideo, webmaster, environnementMedia, referencesMedia
- [ ] Migration douce : valeurs par d√©faut pour artistes existants
- [ ] Indexation des nouveaux champs pour la recherche

### Phase 5 : Optimisation (2 jours)

#### 5.1 Index Firebase
- [ ] Cr√©er les index composites n√©cessaires
- [ ] Documenter dans `firestore.indexes.json`

#### 5.2 Performance
- [ ] Pagination des r√©sultats
- [ ] Cache des requ√™tes fr√©quentes
- [ ] Debounce sur les champs texte

### Phase 6 : Tests et documentation (2 jours)

#### 6.1 Tests
- [ ] Tests unitaires searchService
- [ ] Tests d'int√©gration par section
- [ ] Tests de performance avec volume

#### 6.2 Documentation
- [ ] Guide utilisateur
- [ ] Documentation technique
- [ ] Exemples de requ√™tes

## üöÄ Ordre de priorit√© recommand√©

1. **Jour 1** : ~~Phase 1 compl√®te~~ ‚úÖ + ~~Phase 2 compl√®te~~ ‚úÖ
2. **Semaine 1** : Phase 3 (fonctionnalit√©s simples)
3. **Semaine 2** : Phase 4 (sections complexes)
4. **Semaine 3** : Phase 5 (optimisation) + Phase 6 (tests)
5. **Si temps disponible** : Am√©liorations et fonctionnalit√©s avanc√©es

## üí° D√©cisions √† prendre

1. **Historique** : Sous-collection ou collection globale ?
2. ~~**Infos artiste** : Dans contact ou collection s√©par√©e ?~~ ‚úÖ Utiliser collection `artistes` existante
3. **Performance** : Limite de r√©sultats par d√©faut ?
4. **S√©curit√©** : Qui peut voir quelles s√©lections partag√©es ?
5. **Fiche projet** : R√©utiliser les composants de ContactView ou cr√©er des composants d√©di√©s ?

## üìä Estimation totale : 17-20 jours (r√©vis√©e avec fiche projet compl√®te)

## üìà Progression actuelle

### ‚úÖ Compl√©t√© (07/01/2025)

#### Infrastructure (Phase 1) ‚úÖ
- **Phase 1.1** : Service de recherche et mapping des champs
  - `searchService.js` avec tous les op√©rateurs
  - `searchFieldsMapping.js` pour 6 collections
  - Support multi-crit√®res et multi-collections
  - Gestion intelligente Firestore vs filtrage local
- **Phase 1.2** : Int√©gration dans RechercheLayout
  - Boutons Calculer, Afficher, Enregistrer fonctionnels
  - Affichage des r√©sultats dans la zone centrale
  - Modal de sauvegarde
  - Navigation entre crit√®res et r√©sultats

#### Sections connect√©es (Phase 2 compl√©t√©e) ‚úÖ
- **2.1 Identification** ‚úÖ
  - Mapping complet des champs
  - Tous les op√©rateurs fonctionnels
  - Gestion des dates et bool√©ens
  - Labels lisibles et mise √† jour dynamique
- **2.2 Activit√©s** ‚úÖ
  - Utilisation de la vraie hi√©rarchie TAGS_HIERARCHY
  - Mapping vers le champ `tags` Firebase
  - Support des sous-cat√©gories avec indentation
  - S√©lection multiple avec un seul crit√®re
- **2.4 Genres** ‚úÖ
  - Hi√©rarchie compl√®te depuis GENRES_HIERARCHY
  - Interface accord√©on par cat√©gorie
  - Mapping vers `tags` comme les activit√©s
- **2.5 G√©olocalisation** ‚úÖ
  - Tous les champs g√©ographiques mapp√©s
  - Op√©rateurs sp√©cifiques par type
  - Labels lisibles pour les s√©lections
- **2.3 R√©seaux** ‚úÖ
  - Utilisation de RESEAUX_HIERARCHY (53 r√©seaux)
  - Mapping vers le champ `tags` Firebase
  - Recherche et filtrage interactif
  - S√©lection multiple avec compteur
- **2.6 Festivals** ‚úÖ
  - Mapping complet : nomFestival, commentaires, bouclage
  - S√©lection multi-mois pour bouclage
  - Grille interactive pour p√©riodes de diffusion
  - Conversion des semaines en description lisible
- **2.7 Salles** ‚úÖ
  - Mapping des crit√®res techniques (jauge, dimensions)
  - Recherche par plage de valeurs (min/max)
  - Op√©rateurs dynamiques adapt√©s
  - Unit√©s d'affichage contextuelles
- **2.8 Dates** ‚úÖ
  - Refonte du champ niveau avec 6 √©tats
  - Composant NiveauDisplay pour affichage visuel
  - Recherche par titre, p√©riode, montant
  - Relations avec artistes et lieux

### üöß Prochaines √©tapes imm√©diates
1. ~~**Phase 2.1** : Connecter la section Identification~~ ‚úÖ
2. ~~**Phase 2.2** : Connecter la section Activit√©s~~ ‚úÖ
3. ~~**Phase 2.3** : Connecter la section R√©seaux~~ ‚úÖ
4. ~~**Phase 2.4** : Connecter la section Genres~~ ‚úÖ
5. ~~**Phase 2.5** : Connecter la section G√©olocalisation~~ ‚úÖ
6. ~~**Phase 2.6** : Connecter la section Festivals~~ ‚úÖ
7. ~~**Phase 2.7** : Connecter la section Salles~~ ‚úÖ
8. ~~**Phase 2.8** : Connecter la section Dates~~ ‚úÖ
9. ~~**Phase 3.2** : Mes s√©lections~~ ‚úÖ
10. **Phase 3.3** : Connecter PersonnesSection au syst√®me de recherche
11. **Phase 4** : Sections complexes (Fiche projet, Historique, Infos artiste)

### üìä M√©triques de progression
- **Infrastructure** : 100% ‚úÖ (service cr√©√© et int√©gr√©)
- **Phase 1** : 100% ‚úÖ (infrastructure compl√®te)
- **Phase 2** : 100% ‚úÖ (8/8 sections connect√©es)
- **Phase 3** : 33% (1/3 fonctionnalit√©s - Mes s√©lections ‚úÖ)
- **Global** : ~45% du projet complet

### üéØ Accomplissements du jour 1
- ‚úÖ Infrastructure compl√®te de recherche (Phase 1)
- ‚úÖ Service de recherche avec tous les op√©rateurs
- ‚úÖ Int√©gration UI avec boutons fonctionnels
- ‚úÖ 8 sections connect√©es (Phase 2 compl√®te)
- ‚úÖ Syst√®me de recherche multi-crit√®res op√©rationnel
- ‚úÖ Refonte du champ niveau pour les dates avec affichage visuel adapt√©
- ‚úÖ Impl√©mentation compl√®te de "Mes s√©lections" (Phase 3.2)
- ‚úÖ Service selectionsService.js pour g√©rer les recherches sauvegard√©es
- ‚úÖ Int√©gration dans RechercheLayout avec chargement des s√©lections

### üìÖ Planning r√©vis√©
- **Aujourd'hui** : 10 t√¢ches majeures accomplies (infrastructure + 8 sections + Mes s√©lections)
- **Estimation** : Phase 2 COMPL√âT√âE ‚úÖ + Phase 3 en cours (33%)
- **Gain de temps** : ~2 semaines d'avance sur le planning initial
- **Rythme actuel** : 3x plus rapide que pr√©vu

---
*Plan mis √† jour le 07/01/2025 - Phase 2 COMPL√âT√âE + Phase 3.2 (Mes s√©lections) COMPL√âT√âE*